<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>lcb_enable_timings</title><link rel="stylesheet" type="text/css" href="docbook-xsl.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /></head><body><div xml:lang="en" class="refentry" lang="en"><a id="idp252032"></a><div class="titlepage"></div><div class="refnamediv"><h2>Name</h2><p>lcb_enable_timings — internal timings</p></div><div class="refsynopsisdiv"><a id="_synopsis"></a><h2>Synopsis</h2><p>cc [ flag … ] file… -lcouchbase [ library … ]</p><pre class="literallayout">#include &lt;libcouchbase/couchbase.h&gt;</pre><pre class="literallayout">lcb_error_t lcb_enable_timings(lcb_t instance);</pre><pre class="literallayout">lcb_error_t lcb_disable_timings(lcb_t instance);</pre><pre class="literallayout">lcb_error_t lcb_get_timings(lcb_t instance,
                            const void * cookie,
                            lcb_timings_callback callback);</pre></div><div class="refsect1"><a id="_description"></a><h2>DESCRIPTION</h2><p>libcouchbase provides a simple form of per-command timings you may use
to figure out the current lantency for the request-response cycle as
generated by your application. Please note that these numbers are not
necessarily accurate as you may affect the timing recorded by doing
work in the event loop.</p><p>The time recorded with this library is the time elapsed from the
command being called, and the response packet being received from the
server.  Everything the application does before driving the event loop
will affect the timers.</p><p>The function lcb_enable_timings() is used to enable the timings for
the given instance, and lcb_disable_timings is used to disable the
timings. The overhead of using the timers should be negligible.</p><p>The function lcb_get_timings is used to retrieve the current timing.
values from the given instance. The cookie is passed transparently to
the callback function. The lcb_timings_callback is a function with the
following signature:</p><pre class="literallayout">void  function(lcb_t instance,
               const void *cookie,
               lcb_timeunit_t timeunit,
               lcb_uint32_t min,
               lcb_uint32_t max,
               lcb_uint32_t total,
               lcb_uint32_t maxtotal);</pre><p>instance is the libcouchbase instance that called
lcb_get_timings(). cookie is the cookie provided to
lcb_get_timings(). timeunit is the unit of time for the values (see
below for the values). min and max specify the time range for this
bucket. total is the number of commands within this time range.
maxtotal is the highest number in one of the buckets (this value may
be used to "scale" the other values.</p><div class="refsect2"><a id="_time_units"></a><h3>Time units</h3><p>The following time units are defined:</p><pre class="literallayout">LCB_TIMEUNIT_NSEC     The times are specified in nanoseconds</pre><pre class="literallayout">LCB_TIMEUNIT_USEC     The times are specified in microseconds</pre><pre class="literallayout">LCB_TIMEUNIT_MSEC     The times are specified in milliseconds</pre><pre class="literallayout">LCB_TIMEUNIT_SEC      The times are specified in seconds</pre></div></div><div class="refsect1"><a id="_return_values"></a><h2>RETURN VALUES</h2><p>lcb_enable_timings(), lcb_disable_timings() and lcb_get_timings()
returns LCB_SUCCESS on success, or an error code describing the error
otherwise. See <a class="ulink" href="lcb_strerror.3couchbase.html" target="_top">lcb_strerror(3couchbase)</a> for more information about
error codes.</p></div><div class="refsect1"><a id="_examples"></a><h2>EXAMPLES</h2><p>The following example dumps a small histogram of lantencies</p><pre class="literallayout">#include &lt;libcouchbase/couchbase.h&gt;</pre><pre class="literallayout">...</pre><pre class="literallayout">static void callback(lcb_t instance, const void *cookie,
                     lcb_timeunit_t timeunit,
                     lcb_uint32_t min,
                     lcb_uint32_t max,
                     lcb_uint32_t total,
                     lcb_uint32_t maxtotal)
{
    FILE* out = (void*)cookie;
    int num = (float)10.0 * (float)total / ((float)maxtotal);</pre><pre class="literallayout">fprintf(out, "[%3u - %3u]", min, max);
switch (timeunit) {
case LCB_TIMEUNIT_NSEC:
    fprintf(out, "ns");
    break;
case LCB_TIMEUNIT_USEC:
    fprintf(out, "us");
    break;
case LCB_TIMEUNIT_MSEC:
    fsprintf(out, "ms");
    break;
case LCB_TIMEUNIT_SEC:
    fprintf(out, "s ");
    break;
default:
    ;
}</pre><pre class="literallayout">fprintf(out, " |");
for (int ii = 0; ii &lt; num; ++ii) {
    fprintf(out, "#");
}</pre><pre class="literallayout">    fprintf(out, " - %u\n", total);
}</pre><pre class="literallayout">...
lb_enable_timings(instance);
... do a lot of operations ...</pre><pre class="literallayout">fprintf(stderr, "              +---------+\n"
lcb_get_timings(instance, stderr, callback);
fprintf(stderr, "              +---------+\n"
lcb_disable_timings(instance);
...</pre><p>Note that the source code for libcouchbase also includes an
example program which further demonstrates these functions.</p></div><div class="refsect1"><a id="_attributes"></a><h2>ATTRIBUTES</h2><p>See <a class="ulink" href="lcb_attributes.5.html" target="_top">lcb_attributes(5)</a> for descriptions of the following attributes:</p><div class="informaltable"><table cellpadding="4px" style="border-collapse: collapse;border-top: 3px solid #527bbd; border-bottom: 3px solid #527bbd; border-left: 3px solid #527bbd; border-right: 3px solid #527bbd; "><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"> ATTRIBUTE TYPE      </th><th style="border-bottom: 1px solid #527bbd; " align="left" valign="top"> ATTRIBUTE VALUE</th></tr></thead><tbody><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>Interface Stability</p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>Committed</p></td></tr><tr><td style="border-right: 1px solid #527bbd; " align="left" valign="top"><p>MT-Level</p></td><td style="" align="left" valign="top"><p>MT-Safe</p></td></tr></tbody></table></div></div><div class="refsect1"><a id="_see_also"></a><h2>SEE ALSO</h2><p>Copyright 2010-2013 Couchbase, Inc.</p><p>Learn more at <a class="ulink" href="http://www.couchbase.com/communities/c" target="_top">http://www.couchbase.com/communities/c</a>.</p><p><a class="ulink" href="libcouchbase.3lib.html" target="_top">libcouchbase(3lib)</a>, <a class="ulink" href="lcb_create.3couchbase.html" target="_top">lcb_create(3couchbase)</a>, <a class="ulink" href="lcb_wait.3couchbase.html" target="_top">lcb_wait(3couchbase)</a>,
<a class="ulink" href="lcb_attributes.5.html" target="_top">lcb_attributes(5)</a></p></div></div></body></html>
