<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>lcb_make_http_request</title><link rel="stylesheet" type="text/css" href="docbook-xsl.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /></head><body><div xml:lang="en" class="refentry" lang="en"><a id="idp164176"></a><div class="titlepage"></div><div class="refnamediv"><h2>Name</h2><p>lcb_make_http_request — Create instance</p></div><div class="refsynopsisdiv"><a id="_synopsis"></a><h2>Synopsis</h2><p>cc [ flag … ] file… -lcouchbase [ library … ]</p><pre class="literallayout">#include &lt;libcouchbase/couchbase.h&gt;</pre><pre class="literallayout">lcb_error_t lcb_make_http_request(lcb_t instance,
                                  const void *command_cookie,
                                  lcb_http_type_t type,
                                  const lcb_http_cmd_t *cmd,
                                  lcb_http_request_t *request);</pre></div><div class="refsect1"><a id="_description"></a><h2>DESCRIPTION</h2><p>lcb_make_http_request() is used to execute HTTP requests. If the
library instance is using asynchronous mode (the default) this
operation will return immediately and schedule the operations to be
executed by the event loop, otherwise it will block until all commands
are executed. command_cookie is is an opaque field that will be
provided to the callback function.</p><p>Type specifies the kind of HTTP request and may be one of the following:</p><pre class="literallayout">LCB_HTTP_TYPE_VIEW          Execute a view request</pre><pre class="literallayout">LCB_HTTP_TYPE_MANAGEMENT    Perform management operation</pre><pre class="literallayout">LCB_HTTP_TYPE_RAW           Execute an arbitrary HTTP request</pre><p>lcb_http_cmd_t is a structure defined in &lt;libcouchbase/arguments.h&gt;:</p><pre class="literallayout">typedef struct lcb_http_cmd_st {
    int version;              /* The enty in "v" to use */
    union {
        struct {
            const char *path;
            lcb_size_t npath;
            const void *body;
            lcb_size_t nbody;
            lcb_http_method_t method;
            int chunked;
            const char *content_type;
        } v0;
        struct {
            const char *path;
            lcb_size_t npath;
            const void *body;
            lcb_size_t nbody;
            lcb_http_method_t method;
            int chunked;
            const char *content_type;
            const char *host;
            const char *username;
            const char *password;
        } v1;
    } v;
};</pre><p><code class="literal">LCB_HTTP_TYPE_VIEW</code> and <code class="literal">LCB_HTTP_TYPE_MANAGEMENT</code> should use version 0
of the struct above. <code class="literal">LCB_HTTP_TYPE_RAW</code> must use version 1 which contains
the extra fields: <code class="literal">host</code>, <code class="literal">username</code> and <code class="literal">password</code>. The rest of the fields
are identical.</p><p><code class="literal">path</code> and <code class="literal">npath</code> specifies the document to operate.</p><p><code class="literal">body</code> and <code class="literal">nbody</code> contains the data for HTTP POST requests.</p><p><code class="literal">method</code> contains the type of HTTP request: <code class="literal">LCB_HTTP_METHOD_GET</code>,
<code class="literal">LCB_HTTP_METHOD_POST</code>, <code class="literal">LCB_HTTP_METHOD_PUT</code> or
<code class="literal">LCB_HTTP_METHOD_DELETE</code></p><p><code class="literal">chunked</code> is set to a non-zero value to use chunked http mode</p><p><code class="literal">content_type</code> is used to specify the content type in the HTTP request.</p><p>The last parameter to lcb_make_http_request is an output parameter to
store an identifier for the HTTP request. The request parameter may be
used to cancel the request with <a class="ulink" href="lcb_cancel_http_request.3couchbase.html" target="_top">lcb_cancel_http_request(3couchbase)</a>.</p></div><div class="refsect1"><a id="_return_values"></a><h2>RETURN VALUES</h2></div><div class="refsect1"><a id="_examples"></a><h2>EXAMPLES</h2><p>Example 1: Fetch first 10 docs from <span class="emphasis"><em>_design/test/_view/all</em></span> view</p><pre class="literallayout">lcb_http_request_t req;
lcb_http_cmd_t *cmd = calloc(1, sizeof(lcb_http_cmd_t));
cmd-&gt;version = 0;
cmd-&gt;v.v0.path = "_design/test/_view/all?limit=10";
cmd-&gt;v.v0.npath = strlen(item-&gt;v.v0.path);
cmd-&gt;v.v0.body = NULL;
cmd-&gt;v.v0.nbody = 0;
cmd-&gt;v.v0.method = LCB_HTTP_METHOD_GET;
cmd-&gt;v.v0.chunked = 1;
cmd-&gt;v.v0.content_type = "application/json";
lcb_error_t err = lcb_make_http_request(instance, NULL,
                                        LCB_HTTP_TYPE_VIEW,
                                        &amp;cmd, &amp;req);
if (err != LCB_SUCCESS) {
    ... failed to schedule request ...</pre><p>Example 2: The same as above but with POST filter</p><pre class="literallayout">lcb_http_request_t req;
lcb_http_cmd_t *cmd = calloc(1, sizeof(lcb_http_cmd_t));
cmd-&gt;version = 0;
cmd-&gt;v.v0.path = "_design/test/_view/all?limit=10";
cmd-&gt;v.v0.npath = strlen(item-&gt;v.v0.path);
cmd-&gt;v.v0.body = "{\"keys\": [\"test_1000\", \"test_10002\"]}"
cmd-&gt;v.v0.nbody = strlen(item-&gt;v.v0.body);
cmd-&gt;v.v0.method = LCB_HTTP_METHOD_POST;
cmd-&gt;v.v0.chunked = 1;
cmd-&gt;v.v0.content_type = "application/json";
lcb_error_t err = lcb_make_http_request(instance, NULL,
                                        LCB_HTTP_TYPE_VIEW,
                                        &amp;cmd, &amp;req);
if (err != LCB_SUCCESS) {
    ... failed to schedule request ...</pre><p>Example 3: Delete bucket via REST management API</p><pre class="literallayout">lcb_http_request_t req;
lcb_http_cmd_t *cmd = calloc(1, sizeof(lcb_http_cmd_t));
cmd-&gt;version = 0;
cmd-&gt;v.v0.path = "/pools/default/buckets/mybucket");
cmd-&gt;v.v0.npath = strlen(cmd-&gt;v.v0.path);
cmd-&gt;v.v0.body = NULL;
cmd-&gt;v.v0.nbody = 0;
cmd-&gt;v.v0.method = LCB_HTTP_METHOD_DELETE;
cmd-&gt;v.v0.chunked = false;
cmd-&gt;v.v0.content_type = "application/x-www-form-urlencoded";
lcb_error_t err = lcb_make_http_request(instance, NULL,
                                        LCB_HTTP_TYPE_MANAGEMENT,
                                        &amp;cmd, &amp;req);
if (err != LCB_SUCCESS) {
    ... failed to schedule request ...</pre><p>Example 4: Save design document ‘_design/test’ with trivial ‘all’ view</p><pre class="literallayout">const char *docid = "_design/test";
const char *doc = "{\"views\":{\"all\":{\"map\":\"function (doc, meta) { emit(meta.id, null); }\"}}}";
lcb_http_cmd_t cmd;
lcb_http_request_t req;
cmd.version = 0;
cmd.v.v0.path = docid;
cmd.v.v0.npath = strlen(docid);
cmd.v.v0.body = doc;
cmd.v.v0.nbody = strlen(doc);
cmd.v.v0.method = LCB_HTTP_METHOD_PUT;
cmd.v.v0.content_type = "application/json";
lcb_error_t err = lcb_make_http_request(instance, NULL,
                                        LCB_HTTP_TYPE_VIEW,
                                        &amp;cmd, &amp;req);
if (err != LCB_SUCCESS) {
    ... failed to schedule request ...</pre></div><div class="refsect1"><a id="_attributes"></a><h2>ATTRIBUTES</h2><p>See <a class="ulink" href="lcb_attributes.5.html" target="_top">lcb_attributes(5)</a> for descriptions of the following attributes:</p><div class="informaltable"><table cellpadding="4px" style="border-collapse: collapse;border-top: 3px solid #527bbd; border-bottom: 3px solid #527bbd; border-left: 3px solid #527bbd; border-right: 3px solid #527bbd; "><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"> ATTRIBUTE TYPE      </th><th style="border-bottom: 1px solid #527bbd; " align="left" valign="top"> ATTRIBUTE VALUE</th></tr></thead><tbody><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>Interface Stability</p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>Committed</p></td></tr><tr><td style="border-right: 1px solid #527bbd; " align="left" valign="top"><p>MT-Level</p></td><td style="" align="left" valign="top"><p>MT-Safe</p></td></tr></tbody></table></div></div><div class="refsect1"><a id="_see_also"></a><h2>SEE ALSO</h2><p>Copyright 2010-2013 Couchbase, Inc.</p><p>Learn more at <a class="ulink" href="http://www.couchbase.com/communities/c" target="_top">http://www.couchbase.com/communities/c</a>.</p><p><a class="ulink" href="libcouchbase.3lib.html" target="_top">libcouchbase(3lib)</a>, <a class="ulink" href="lcb_create.3couchbase.html" target="_top">lcb_create(3couchbase)</a>,
<a class="ulink" href="lcb_cancel_http_request.3couchbase.html" target="_top">lcb_cancel_http_request(3couchbase)</a>,
<a class="ulink" href="lcb_set_http_data_callback.3couchbase.html" target="_top">lcb_set_http_data_callback(3couchbase)</a>,
<a class="ulink" href="lcb_set_http_complete_callback.3couchbase.html" target="_top">lcb_set_http_complete_callback(3couchbase)</a>, <a class="ulink" href="lcb_attributes.5.html" target="_top">lcb_attributes(5)</a></p></div></div></body></html>
