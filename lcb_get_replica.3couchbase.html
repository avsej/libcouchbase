<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>lcb_get_replica</title><link rel="stylesheet" type="text/css" href="docbook-xsl.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /></head><body><div xml:lang="en" class="refentry" lang="en"><a id="idp158048"></a><div class="titlepage"></div><div class="refnamediv"><h2>Name</h2><p>lcb_get_replica — Retrieve a document from a replica location in the cluster</p></div><div class="refsynopsisdiv"><a id="_synopsis"></a><h2>Synopsis</h2><p>cc [ flag … ] file… -lcouchbase [ library … ]</p><pre class="literallayout">#include &lt;libcouchbase/couchbase.h&gt;</pre><pre class="literallayout">lcb_error_t lcb_get_replica(lcb_t instance,
                            const void *command_cookie,
                            lcb_size_t num,
                            const lcb_get_replica_cmd_t *const *commands);</pre></div><div class="refsect1"><a id="_description"></a><h2>DESCRIPTION</h2><p>lcb_get_replica() is used to retrieve replica documents from the cluster.  If
the library instance is using asynchronous mode (the default) this
operation will return immediately and schedule the operations to be
executed by the event loop, otherwise it will block until all commands
are executed. command_cookie is is an opaque field that will be
provided to the callback function.  num is the number of entries in
the commands array.</p><p>lcb_get_replica_cmd_t is a structure defined in &lt;libcouchbase/arguments.h&gt;:</p><pre class="literallayout">typedef struct lcb_get_replica_cmd_st {
    int version;              /* The enty in "v" to use */
    union {
        struct {
            const void *key;    /* The key this response belongs to */
            lcb_size_t nkey;    /* The number of bytes in the key */
            const void *hashkey; /* hash key if != key */
            lcb_size_t nhashkey; /* number of bytes in hash key */
        } v0;
        struct {
            const void *key;
            lcb_size_t nkey;
            const void *hashkey;
            lcb_size_t nhashkey;
            lcb_replica_t strategy; /* how to select replica node */
            int index;              /* the replica index in case
                                       LCB_REPLICA_SELECT strategy */
        } v1;
    } v;
} lcb_get_replica_cmd_t;</pre><p>Upon completion the get callback as set by lcb_set_get_callback is called.</p><p>From command version 1, it is possible to select strategy of how to
select the replica node. Currently three strategies are available:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
LCB_REPLICA_FIRST: Previously accessible and default as of 2.0.8,
   the caller will get a reply from the first replica to successfully
   reply within the timeout for the operation or will receive an
   error.
</li><li class="listitem">
LCB_REPLICA_ALL: Ask all replicas to send documents/items
   back.
</li><li class="listitem">
LCB_REPLICA_SELECT: Select one replica by the index in the
   configuration starting from zero. This approach can more quickly
   receive all possible replies for a given topology, but it can
   also generate false negatives.
</li></ol></div><p>Note that applications should not assume the order of the
replicas indicates more recent data is at a lower index number.
It is up to the application to determine which version of a
document/item it may wish to use in the case of retrieving data
from a replica.</p></div><div class="refsect1"><a id="_return_values"></a><h2>RETURN VALUES</h2><p>lcb_get_replica() returns the LCB_SUCCESS on success, or a specific
error code upon failure.  See <a class="ulink" href="lcb_strerror.3couchbase.html" target="_top">lcb_strerror(3couchbase)</a> for more
information.</p></div><div class="refsect1"><a id="_examples"></a><h2>EXAMPLES</h2><p>Example 1: Get document from the second replica</p><pre class="literallayout">#include &lt;libcouchbase/couchbase.h&gt;</pre><pre class="literallayout">...
lcb_t instance;
...
lcb_get_replica_cmd_t *get = calloc(1, sizeof(*get));
get-&gt;version = 1;
get-&gt;v.v1.key = "my-key";
get-&gt;v.v1.nkey = strlen(get-&gt;v.v0.key);
get-&gt;v.v1.strategy = LCB_REPLICA_SELECT;
get-&gt;v.v1.index = 2;
lcb_get_replica_cmd_st* commands[] = { get };
lcb_get_replica(instance, NULL, 1, commands);
...</pre><p>Example 2: Get document from the first available replica</p><pre class="literallayout">#include &lt;libcouchbase/couchbase.h&gt;</pre><pre class="literallayout">...
lcb_t instance;
...
lcb_get_replica_cmd_t *get = calloc(1, sizeof(*get));
get-&gt;version = 1;
get-&gt;v.v1.key = "my-key";
get-&gt;v.v1.nkey = strlen(get-&gt;v.v0.key);
get-&gt;v.v1.strategy = LCB_REPLICA_FIRST;
lcb_get_replica_cmd_st* commands[] = { get };
lcb_get_replica(instance, NULL, 1, commands);
...</pre><p>Example 3: Get document from all replicas (will generate
           lcb_get_num_replicas() responses)</p><pre class="literallayout">#include &lt;libcouchbase/couchbase.h&gt;</pre><pre class="literallayout">...
lcb_t instance;
...
lcb_get_replica_cmd_t *get = calloc(1, sizeof(*get));
get-&gt;version = 1;
get-&gt;v.v1.key = "my-key";
get-&gt;v.v1.nkey = strlen(get-&gt;v.v0.key);
get-&gt;v.v1.strategy = LCB_REPLICA_ALL;
lcb_get_replica_cmd_st* commands[] = { get };
lcb_get_replica(instance, NULL, 1, commands);
...</pre><p>Example 4: Simple get replica (API v0)</p><pre class="literallayout">#include &lt;libcouchbase/couchbase.h&gt;</pre><pre class="literallayout">...
lcb_t instance;
...
lcb_get_replica_cmd_t *get = calloc(1, sizeof(*get));
get-&gt;version = 0;
get-&gt;v.v0.key = "my-key";
get-&gt;v.v0.nkey = strlen(get-&gt;v.v0.key);
lcb_get_replica_cmd_st* commands[] = { get };
lcb_get_replica(instance, NULL, 1, commands);
...</pre></div><div class="refsect1"><a id="_attributes"></a><h2>ATTRIBUTES</h2><p>See <a class="ulink" href="lcb_attributes.5.html" target="_top">lcb_attributes(5)</a> for descriptions of the following attributes:</p><div class="informaltable"><table cellpadding="4px" style="border-collapse: collapse;border-top: 3px solid #527bbd; border-bottom: 3px solid #527bbd; border-left: 3px solid #527bbd; border-right: 3px solid #527bbd; "><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"> ATTRIBUTE TYPE      </th><th style="border-bottom: 1px solid #527bbd; " align="left" valign="top"> ATTRIBUTE VALUE</th></tr></thead><tbody><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>Interface Stability</p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>Committed</p></td></tr><tr><td style="border-right: 1px solid #527bbd; " align="left" valign="top"><p>MT-Level</p></td><td style="" align="left" valign="top"><p>MT-Safe</p></td></tr></tbody></table></div></div><div class="refsect1"><a id="_see_also"></a><h2>SEE ALSO</h2><p>Copyright 2010-2013 Couchbase, Inc.</p><p>Learn more at <a class="ulink" href="http://www.couchbase.com/communities/c" target="_top">http://www.couchbase.com/communities/c</a>.</p><p><a class="ulink" href="libcouchbase.3lib.html" target="_top">libcouchbase(3lib)</a>, <a class="ulink" href="lcb_get_get_callback.3couchbase.html" target="_top">lcb_get_get_callback(3couchbase)</a>,
<a class="ulink" href="lcb_set_get_callback.3couchbase.html" target="_top">lcb_set_get_callback(3couchbase)</a>, <a class="ulink" href="lcb_attributes.5.html" target="_top">lcb_attributes(5)</a></p></div></div></body></html>
